<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SRS å­¸ç¿’ç³»çµ±</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- é…ç½®æ–‡ä»¶ -->
  <script src="shared/js/config.js"></script>
  <style>
    :root {
      /* === ä¸»è¦è‰²å½©ç³»çµ± === */
      --primary: #7C4DFF;
      --primary-dark: #6C63FF;
      --primary-light: #B39DFF;
      --secondary: #2196F3;
      --secondary-dark: #1976D2;
      --secondary-light: #64B5F6;
      
      /* === èªç¾©è‰²å½© === */
      --success: #43e97b;
      --success-dark: #38d967;
      --success-light: #66efac;
      --error: #ff5252;
      --error-dark: #e53935;
      --error-light: #ff8a80;
      --warning: #ff9800;
      --warning-dark: #f57c00;
      --warning-light: #ffb74d;
      --info: #2196F3;
      
      /* === ä¸­æ€§è‰²å½© === */
      --white: #ffffff;
      --gray-50: #fafafa;
      --gray-100: #f5f5f5;
      --gray-200: #eeeeee;
      --gray-300: #e0e0e0;
      --gray-400: #bdbdbd;
      --gray-500: #9e9e9e;
      --gray-600: #757575;
      --gray-700: #616161;
      --gray-800: #424242;
      --gray-900: #212121;
      
      /* === æ–‡å­—è‰²å½© === */
      --text-primary: #212121;
      --text-secondary: #757575;
      --text-muted: #9e9e9e;
      --text-disabled: #bdbdbd;
      
      /* === èƒŒæ™¯è‰²å½© === */
      --bg-primary: linear-gradient(135deg, #7C4DFF 0%, #2196F3 100%);
      --bg-card: #ffffff;
      --bg-overlay: rgba(255, 255, 255, 0.1);
      --bg-hover: rgba(124, 77, 255, 0.08);
      
      /* === é™°å½±å’Œé‚Šæ¡† === */
      --shadow-light: 0 2px 8px rgba(124, 77, 255, 0.08);
      --shadow-medium: 0 4px 16px rgba(124, 77, 255, 0.12);
      --shadow-heavy: 0 8px 32px rgba(60, 0, 100, 0.12);
      --border-light: 1px solid var(--gray-200);
      --border-medium: 1.5px solid var(--gray-300);
      --border-focus: 1.5px solid var(--secondary);
      
      /* === è¨­è¨ˆç³»çµ± === */
      --card-radius: 20px;
      --button-radius: 999px;
      --input-radius: 8px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      
      /* === å­—é«”ç³»çµ± === */
      --font-size-xs: 0.75rem;    /* 12px */
      --font-size-sm: 0.875rem;   /* 14px */
      --font-size-base: 1rem;     /* 16px */
      --font-size-lg: 1.125rem;   /* 18px */
      --font-size-xl: 1.25rem;    /* 20px */
      --font-size-2xl: 1.5rem;    /* 24px */
      --font-size-3xl: 1.875rem;  /* 30px */
      --font-size-4xl: 2.25rem;   /* 36px */
      
      --font-weight-normal: 400;
      --font-weight-medium: 500;
      --font-weight-semibold: 600;
      --font-weight-bold: 700;
      
      --line-height-tight: 1.25;
      --line-height-snug: 1.375;
      --line-height-normal: 1.5;
      --line-height-relaxed: 1.625;
      --line-height-loose: 2;
      
      --letter-spacing-tighter: -0.05em;
      --letter-spacing-tight: -0.025em;
      --letter-spacing-normal: 0;
      --letter-spacing-wide: 0.025em;
      --letter-spacing-wider: 0.05em;
      --letter-spacing-widest: 0.1em;
      
      /* === é–“è·ç³»çµ± === */
      --spacing-xs: 0.25rem;   /* 4px */
      --spacing-sm: 0.5rem;    /* 8px */
      --spacing-md: 1rem;      /* 16px */
      --spacing-lg: 1.5rem;    /* 24px */
      --spacing-xl: 2rem;      /* 32px */
      --spacing-2xl: 3rem;     /* 48px */
      --spacing-3xl: 4rem;     /* 64px */
    }

    body {
      min-height: 100vh;
      margin: 0;
      background: var(--bg-primary);
      font-family: 'Noto Sans TC', 'Montserrat', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-normal);
      line-height: var(--line-height-normal);
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--card-radius);
      box-shadow: var(--shadow-heavy);
      padding: var(--spacing-2xl) var(--spacing-xl);
      margin: var(--spacing-xl) auto;
      max-width: 420px;
      width: 100%;
      text-align: center;
      transition: var(--transition);
    }

    h1 {
      color: var(--primary);
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-4xl);
      line-height: var(--line-height-tight);
      margin-bottom: var(--spacing-sm);
      letter-spacing: var(--letter-spacing-wide);
    }

    h2 {
      color: var(--primary-dark);
      font-weight: var(--font-weight-normal);
      font-size: var(--font-size-lg);
      line-height: var(--line-height-relaxed);
      margin-bottom: var(--spacing-lg);
      opacity: 0.85;
    }

    h3 {
      color: var(--text-primary);
      font-weight: var(--font-weight-semibold);
      font-size: var(--font-size-xl);
      line-height: var(--line-height-snug);
      margin-bottom: var(--spacing-md);
      margin-top: var(--spacing-lg);
    }

    input[type="text"], input[type="password"] {
      width: 80%;
      padding: var(--spacing-md);
      margin: var(--spacing-sm) 0;
      border: var(--border-medium);
      border-radius: var(--input-radius);
      font-size: var(--font-size-lg);
      font-family: inherit;
      line-height: var(--line-height-normal);
      color: var(--text-primary);
      background: var(--white);
      transition: var(--transition);
    }

    input[type="text"]:focus, input[type="password"]:focus {
      border: var(--border-focus);
      outline: none;
      box-shadow: var(--shadow-light);
    }

    /* === çµ±ä¸€æŒ‰éˆ•æ¨£å¼ç³»çµ± === */
    button {
      border: none;
      border-radius: var(--button-radius);
      padding: var(--spacing-md) var(--spacing-xl);
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-bold);
      line-height: var(--line-height-normal);
      margin: var(--spacing-sm);
      cursor: pointer;
      transition: var(--transition);
      letter-spacing: var(--letter-spacing-wider);
      font-family: inherit;
      position: relative;
      overflow: hidden;
    }

    /* ä¸»è¦æŒ‰éˆ•æ¨£å¼ */
    button, .btn-primary {
      background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
      color: var(--white);
      box-shadow: var(--shadow-light);
    }

    button:hover, .btn-primary:hover {
      background: linear-gradient(90deg, var(--secondary) 0%, var(--primary) 100%);
      box-shadow: var(--shadow-medium);
      transform: translateY(-2px);
    }

    /* æˆåŠŸæŒ‰éˆ•æ¨£å¼ */
    .btn-success {
      background: linear-gradient(90deg, var(--success) 0%, var(--success-light) 100%);
      color: var(--white);
      box-shadow: 0 2px 8px rgba(67, 233, 123, 0.15);
    }

    .btn-success:hover {
      background: linear-gradient(90deg, var(--success-dark) 0%, var(--success) 100%);
      box-shadow: 0 4px 16px rgba(67, 233, 123, 0.25);
      transform: translateY(-2px);
    }

    /* éŒ¯èª¤/å±éšªæŒ‰éˆ•æ¨£å¼ */
    .btn-danger {
      background: linear-gradient(90deg, var(--error) 0%, var(--warning) 100%);
      color: var(--white);
      box-shadow: 0 2px 8px rgba(255, 82, 82, 0.15);
    }

    .btn-danger:hover {
      background: linear-gradient(90deg, var(--error-dark) 0%, var(--error) 100%);
      box-shadow: 0 4px 16px rgba(255, 82, 82, 0.25);
      transform: translateY(-2px);
    }

    /* æ¬¡è¦æŒ‰éˆ•æ¨£å¼ */
    .btn-secondary {
      background: linear-gradient(90deg, var(--gray-100) 0%, var(--gray-200) 100%);
      color: var(--text-secondary);
      box-shadow: var(--shadow-light);
    }

    .btn-secondary:hover {
      background: linear-gradient(90deg, var(--gray-200) 0%, var(--gray-300) 100%);
      box-shadow: var(--shadow-medium);
      transform: translateY(-2px);
    }

    /* å°å°ºå¯¸æŒ‰éˆ• */
    .btn-small {
      padding: var(--spacing-sm) var(--spacing-lg);
      font-size: var(--font-size-sm);
      margin: var(--spacing-xs);
    }

    /* å¤§å°ºå¯¸æŒ‰éˆ• */
    .btn-large {
      padding: var(--spacing-lg) var(--spacing-2xl);
      font-size: var(--font-size-xl);
      margin: var(--spacing-md);
    }

    /* ç¦ç”¨æŒ‰éˆ• */
    button:disabled, .btn-disabled {
      background: var(--gray-400);
      color: var(--white);
      cursor: not-allowed;
      box-shadow: none;
      opacity: 0.6;
    }

    button:disabled:hover, .btn-disabled:hover {
      transform: none;
      box-shadow: none;
    }

    /* === æ”¹é€²çš„é–“è·å’Œä½ˆå±€ç³»çµ± === */
    .button-group {
      margin: var(--spacing-lg) 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: var(--spacing-sm);
    }

    .button-group button {
      margin: var(--spacing-xs);
    }

    .section-spacing {
      margin: var(--spacing-lg) 0;
    }

    .text-muted {
      color: var(--text-muted);
      font-size: var(--font-size-sm);
      line-height: var(--line-height-relaxed);
    }

    .text-center {
      text-align: center;
    }

    .mt-1 { margin-top: var(--spacing-md); }
    .mt-2 { margin-top: var(--spacing-xl); }
    .mb-1 { margin-bottom: var(--spacing-md); }
    .mb-2 { margin-bottom: var(--spacing-xl); }
    .mx-auto { margin-left: auto; margin-right: auto; }
    .text-center { text-align: center; }

    /* === æ”¹é€²çš„çµ±è¨ˆå’Œç‹€æ…‹é¡¯ç¤º === */
    .stats {
      display: flex;
      justify-content: space-around;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 1em;
      margin: 1em 0;
      backdrop-filter: blur(10px);
    }

    .stat {
      text-align: center;
      color: var(--text-secondary);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
    }

    .stat span {
      display: block;
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      line-height: var(--line-height-tight);
      color: var(--primary);
      margin-top: var(--spacing-xs);
    }

    /* === æ”¹é€²çš„è¼¸å…¥æ¬„ä½æ¨£å¼ === */
    input[type="number"] {
      width: 80px;
      text-align: center;
      border: var(--border-medium);
      border-radius: var(--input-radius);
      padding: 0.5em;
      font-size: 1em;
      font-family: inherit;
      color: var(--text-primary);
      background: var(--white);
      transition: var(--transition);
    }

    input[type="number"]:focus {
      border: var(--border-focus);
      outline: none;
      box-shadow: var(--shadow-light);
    }

    /* === æ”¹é€²çš„å•é¡Œå’Œç­”æ¡ˆæ¨£å¼ === */
    .sentence {
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-semibold);
      color: var(--text-primary);
      margin: var(--spacing-md) 0;
      line-height: var(--line-height-snug);
    }

    .meaning {
      color: var(--text-secondary);
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-normal);
      margin: var(--spacing-md) 0;
      line-height: var(--line-height-relaxed);
    }

    .word-length {
      color: var(--text-muted);
      font-size: var(--font-size-sm);
      margin: var(--spacing-sm) 0;
      line-height: var(--line-height-normal);
    }

    .result-success {
      background: var(--success);
      color: var(--white);
      border-radius: 12px;
      padding: 1em;
      margin: 1em 0;
      font-size: 1.2em;
      font-weight: bold;
      text-align: center;
      animation: fadeIn 0.5s;
      box-shadow: var(--shadow-light);
    }

    .result-error {
      background: var(--error);
      color: var(--white);
      border-radius: 12px;
      padding: 1em;
      margin: 1em 0;
      font-size: 1.2em;
      font-weight: bold;
      text-align: center;
      animation: fadeIn 0.5s;
      box-shadow: var(--shadow-light);
    }

    /* === ä½ˆå±€å¢å¼·å’ŒéŸ¿æ‡‰å¼è¨­è¨ˆ === */
    @media (max-width: 480px) {
      .card {
        padding: var(--spacing-lg) var(--spacing-md);
        margin: var(--spacing-md) var(--spacing-sm);
        max-width: calc(100vw - 2rem);
      }
      
      h1 {
        font-size: var(--font-size-3xl);
      }
      
      .button-group {
        flex-direction: column;
        align-items: center;
      }
      
      .button-group button {
        width: 80%;
        max-width: 280px;
      }
      
      .stats {
        flex-direction: column;
        gap: var(--spacing-md);
      }
    }

    /* === å‹•ç•«å’Œè½‰å ´å¢å¼· === */
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(60, 0, 100, 0.15);
    }

    .button-group button {
      transition: var(--transition);
    }

    .stats {
      background: var(--bg-overlay);
      border-radius: 12px;
      padding: var(--spacing-md);
      margin: var(--spacing-md) 0;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* === è¼‰å…¥ç‹€æ…‹ === */
    .loading {
      opacity: 0.7;
      pointer-events: none;
      position: relative;
    }

    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin: -10px 0 0 -10px;
      border: 2px solid var(--primary);
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* === ç„¦é»å’Œç„¡éšœç¤™æ”¹å–„ === */
    button:focus, input:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* === ç‹€æ…‹æŒ‡ç¤ºå™¨ === */
    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: var(--spacing-sm);
    }

    .status-new { background: var(--info); }
    .status-review { background: var(--warning); }
    .status-mastered { background: var(--success); }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px);}
      to { opacity: 1; transform: translateY(0);}
    }

    .sentence {
      font-size: 1.3em;
      margin: 1.2em 0 0.5em 0;
      color: #333;
      font-weight: 500;
    }

    .meaning {
      color: #666;
      margin: 0.5em 0;
      font-size: 1.1em;
    }

    .word-length {
      color: #999;
      font-size: 0.95em;
      margin-bottom: 1em;
    }

    .stats {
      display: flex;
      justify-content: space-around;
      margin-top: 1.5em;
    }

    .stats .stat {
      background: #f3f3ff;
      border-radius: 12px;
      padding: 0.7em 1.2em;
      color: var(--main-purple);
      font-weight: bold;
      font-size: 1.1em;
    }

    .word-card {
      background: #f8f9ff;
      border: 1px solid #e8eaff;
      border-radius: 12px;
      padding: 1em;
      margin: 0.5em 0;
      transition: all 0.2s;
    }

    .word-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(124,77,255,0.1);
    }

    .word-card .word-title {
      font-size: 1.3em;
      font-weight: bold;
      color: #7C4DFF;
      margin-bottom: 0.3em;
    }

    .word-card .word-definition {
      color: #666;
      margin-bottom: 0.3em;
    }

    .word-card .word-sentence {
      font-style: italic;
      color: #888;
      font-size: 0.9em;
    }

    .pagination-btn {
      background: #f0f0f0;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 0.5em 1em;
      margin: 0 0.2em;
      cursor: pointer;
      transition: all 0.2s;
    }

    .pagination-btn:hover {
      background: #7C4DFF;
      color: white;
    }

    .pagination-btn.active {
      background: #7C4DFF;
      color: white;
    }

    .progress-card {
      background: #f8f9ff;
      border: 1px solid #e8eaff;
      border-radius: 12px;
      padding: 1em;
      margin: 0.5em 0;
      transition: all 0.2s;
      position: relative;
    }

    .progress-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(124,77,255,0.1);
    }

    .progress-card .progress-word {
      font-size: 1.3em;
      font-weight: bold;
      color: #7C4DFF;
      margin-bottom: 0.3em;
    }

    .progress-card .progress-definition {
      color: #666;
      margin-bottom: 0.5em;
    }

    .progress-card .progress-status {
      display: inline-block;
      padding: 0.3em 0.8em;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: bold;
      margin-bottom: 0.5em;
    }

    .progress-card .status-learning {
      background: #fff3cd;
      color: #856404;
    }

    .progress-card .status-reviewing {
      background: #d1ecf1;
      color: #0c5460;
    }

    .progress-card .progress-time {
      color: #888;
      font-size: 0.9em;
    }

    .progress-card .next-review {
      position: absolute;
      top: 1em;
      right: 1em;
      font-size: 0.8em;
      color: #999;
    }

    @media (max-width: 600px) {
      .card {
        padding: 1.2rem 0.5rem;
        max-width: 98vw;
      }
      input[type="text"], input[type="password"] {
        width: 95%;
      }
      
      #word-search {
        width: 100% !important;
        margin-top: 0.5em;
      }
      
      .card #word-display h1 {
        font-size: 1.5em;
      }
    }
  </style>
</head>
<body>
  <div class="card" id="login-card">
    <h1>SRS å­¸ç¿’ç³»çµ±</h1>
    <h2>é–“éš”å­¸ç¿’ x å–®å­—å¼·åŒ–</h2>
    <input id="username" type="text" placeholder="å¸³è™Ÿ">
    <input id="password" type="password" placeholder="å¯†ç¢¼">
    <button onclick="login()">ç™»å…¥</button>
    <div id="loginMsg"></div>
  </div>

  <!--
  <div id="register">
    <h2>è¨»å†Š</h2>
    <input id="reg_username" placeholder="å¸³è™Ÿ">
    <input id="reg_password" type="password" placeholder="å¯†ç¢¼">
    <button onclick="register()">è¨»å†Š</button>
    <div id="regMsg"></div>
  </div>
  -->

  <div class="card" id="main" style="display:none;">
    <h1>å­¸ç¿’é¸å–®</h1>
    
    <!-- ä¸»è¦å­¸ç¿’åŠŸèƒ½ -->
    <div class="button-group">
      <button id="typing-practice-btn">é–‹å§‹ç·´ç¿’</button>
      <button id="srs-learning-btn">SRS å­¸ç¿’</button>
    </div>
    
    <!-- é€²åº¦å’Œè¤‡ç¿’ -->
    <div class="button-group">
      <button onclick="getProgress()">æŸ¥è©¢æˆ‘çš„é€²åº¦</button>
      <button onclick="getReview()">é–‹å§‹è¤‡ç¿’</button>
    </div>
    
    <!-- å–®å­—ç®¡ç† -->
    <div class="button-group">
      <button onclick="showWordLists()">å–®å­—åˆ—è¡¨</button>
    </div>
    
    <button onclick="logout()" class="btn-secondary mt-1">ç™»å‡º</button>
    
    <!-- æ•¸æ“šé¡¯ç¤ºå€ -->
  </div>

  <!-- è¤‡ç¿’æ¨¡å¼å€å¡Š -->
  <div class="card" id="review-mode" style="display:none;">
    <h2>è¤‡ç¿’æ¨¡å¼</h2>
    
    <!-- è¤‡ç¿’ç‹€æ…‹ -->
    <div id="review-status">
      <div class="stats">
        <div class="stat">å¾…è¤‡ç¿’å–®å­— <span id="review-count-display">0</span></div>
        <div class="stat">å·²å®Œæˆ <span id="review-completed">0</span></div>
      </div>
    </div>
    
    <!-- é¡Œç›®é¡¯ç¤ºå€ -->
    <div id="review-question-area" style="display:none;">
      <p id="review-word" class="sentence" style="font-size: 1.8em; font-weight: bold; color: #7C4DFF;"></p>
      <p id="review-definition" class="meaning"></p>
      <p style="color: #666; margin-top: 1em;">é€™å€‹å–®å­—ä½ è¨˜å¾—å—ï¼Ÿ</p>
    </div>
    
    <!-- ç­”æ¡ˆé¸æ“‡å€ -->
    <div id="review-answer-area" style="display:none;">
      <div style="margin: 1.5em 0;">
        <button id="review-correct" class="btn-success" onclick="answerReview(true)">è¨˜å¾— âœ“</button>
        <button id="review-wrong" class="btn-danger" onclick="answerReview(false)">å¿˜è¨˜ âœ—</button>
      </div>
    </div>
    
    <!-- çµæœé¡¯ç¤ºå€ -->
    <div id="review-result-area" style="display: none;">
      <p id="review-result-message"></p>
      <p id="review-next-time" style="color: #666; font-size: 0.9em;"></p>
      <button id="review-next-question" onclick="nextReviewQuestion()">ä¸‹ä¸€é¡Œ</button>
    </div>
    
    <!-- å®Œæˆé¡¯ç¤ºå€ -->
    <div id="review-complete-area" style="display: none;">
      <p style="font-size: 1.2em; color: #43e97b; font-weight: bold;">ğŸ‰ ä»Šæ—¥è¤‡ç¿’å®Œæˆï¼</p>
      <p style="color: #666;">æ­å–œä½ å®Œæˆäº†æ‰€æœ‰éœ€è¦è¤‡ç¿’çš„å–®å­—ï¼</p>
      <button onclick="showMainMenu()" style="margin-top: 1em;">è¿”å›ä¸»é¸å–®</button>
    </div>
    
    <!-- æ§åˆ¶æŒ‰éˆ• -->
    <div id="review-controls">
      <button id="review-start" onclick="startReviewMode()">é–‹å§‹è¤‡ç¿’</button>
      <button onclick="showMainMenu()">è¿”å›ä¸»é¸å–®</button>
    </div>
  </div>

  <!-- å–®å­—åˆ—è¡¨é¸æ“‡é é¢ -->
  <div class="card" id="word-lists" style="display:none;">
    <h1>å–®å­—åˆ—è¡¨</h1>
    <h2>é¸æ“‡è¦æŸ¥çœ‹çš„å–®å­—ç­‰ç´š</h2>
    
    <div style="margin: 1.5em 0;">
      <button onclick="showWordsByLevel(400)">400 åŸºç¤å–®å­—</button>
      <button onclick="showWordsByLevel(1200)">1200 é€²éšå–®å­—</button>
      <button onclick="showWordsByLevel(2000)">2000 ä¸­é«˜ç´šå–®å­—</button>
    </div>
    
    <div style="margin: 1.5em 0; opacity: 0.6;">
      <button disabled>4500 å–®å­— (å³å°‡æ¨å‡º)</button>
      <button disabled>7000 å–®å­— (å³å°‡æ¨å‡º)</button>
    </div>
    
    <button onclick="showMainMenu()">è¿”å›ä¸»é¸å–®</button>
  </div>

  <!-- å–®å­—é¡¯ç¤ºé é¢ -->
  <div class="card" id="word-display" style="display:none;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1em;">
      <h1 id="word-display-title">å–®å­—åˆ—è¡¨</h1>
      <input type="text" id="word-search" placeholder="æœå°‹å–®å­—..." style="width: 200px;">
    </div>
    
    <div id="word-stats" style="margin-bottom: 1em; color: #666;"></div>
    
    <div id="word-container" style="max-height: 400px; overflow-y: auto;">
      <!-- å–®å­—å¡ç‰‡æœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
    </div>
    
    <div id="pagination" style="margin-top: 1em; text-align: center;">
      <!-- åˆ†é æŒ‰éˆ•æœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
    </div>
    
    <button onclick="showWordLists()">è¿”å›åˆ—è¡¨é¸æ“‡</button>
    <button onclick="showMainMenu()">è¿”å›ä¸»é¸å–®</button>
  </div>

  <!-- å­¸ç¿’é€²åº¦é é¢ -->
  <div class="card" id="progress-display" style="display:none;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1em;">
      <h1>æˆ‘çš„å­¸ç¿’é€²åº¦</h1>
      <input type="text" id="progress-search" placeholder="æœå°‹å–®å­—..." style="width: 200px;">
    </div>
    
    <div id="progress-stats" style="margin-bottom: 1em; color: #666;"></div>
    
    <div id="progress-container" style="max-height: 400px; overflow-y: auto;">
      <!-- é€²åº¦å¡ç‰‡æœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
    </div>
    
    <div id="progress-pagination" style="margin-top: 1em; text-align: center;">
      <!-- åˆ†é æŒ‰éˆ•æœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
    </div>
    
    <button onclick="showMainMenu()">è¿”å›ä¸»é¸å–®</button>
  </div>

  <!-- é›£åº¦é¸æ“‡å€å¡Š -->
  <div class="card" id="difficulty-selection" style="display:none;">
    <h2>é¸æ“‡ç·´ç¿’æ¨¡å¼</h2>
    <button onclick="startPractice('400')">400 å–®å­—ç·´ç¿’</button>
    <button onclick="startPractice('1200')">1200 å–®å­—ç·´ç¿’</button>
    <button onclick="startPractice('2000')">2000 å–®å­—ç·´ç¿’</button>
    <button onclick="startPractice('mixed')">æ··åˆæ¨¡å¼</button>
    <button onclick="showMainMenu()">è¿”å›ä¸»é¸å–®</button>
  </div>

  <!-- SRS è¨­å®šå€å¡Š -->
  <div class="card" id="srs-settings" style="display:none;">
    <h2>SRS å­¸ç¿’è¨­å®š</h2>
    
    <div class="section-spacing">
      <h3>é¸æ“‡å­¸ç¿’ç¯„åœ</h3>
      <div class="button-group">
        <button id="srs-400" class="btn-primary" onclick="selectSrsLevel('400')">400 å–®å­—</button>
        <button id="srs-1200" class="btn-primary" onclick="selectSrsLevel('1200')">1200 å–®å­—</button>
        <button id="srs-2000" class="btn-primary" onclick="selectSrsLevel('2000')">2000 å–®å­—</button>
        <button id="srs-mixed" class="btn-primary" onclick="selectSrsLevel('mixed')">æ··åˆæ¨¡å¼</button>
      </div>
    </div>
    
    <div class="section-spacing">
      <h3>æ¯æ—¥æ–°å–®å­—æ•¸é‡</h3>
      <div class="text-center">
        <input type="number" id="srs-daily-limit" min="5" max="50" value="10" />
        <span style="margin-left: 0.5em;">å€‹æ–°å–®å­—</span>
      </div>
    </div>
    
    <button onclick="startSrsSession()">é–‹å§‹ SRS å­¸ç¿’</button>
    <button onclick="showMainMenu()">è¿”å›ä¸»é¸å–®</button>
  </div>

  <!-- SRS å­¸ç¿’å€å¡Š -->
  <div class="card" id="srs-learning" style="display:none;">
    <h2 id="srs-title">SRS é–“éš”é‡è¤‡å­¸ç¿’</h2>
    
    <!-- å­¸ç¿’ç‹€æ…‹ -->
    <div id="srs-status">
      <div class="stats">
        <div class="stat">å¾…è¤‡ç¿’ <span id="srs-review-count">0</span></div>
        <div class="stat">æ–°å–®å­— <span id="srs-new-count">0</span></div>
        <div class="stat">ä»Šæ—¥å®Œæˆ <span id="srs-today-count">0</span></div>
      </div>
      <div class="text-center text-muted mt-1">
        <span>ä»Šæ—¥ç›®æ¨™ï¼š<span id="srs-daily-goal">10</span> å€‹æ–°å–®å­—</span>
      </div>
    </div>
    
    <!-- é¡Œç›®é¡¯ç¤ºå€ -->
    <div id="srs-question-area" style="display:none;">
      <p id="srs-sentence" class="sentence"></p>
      <p id="srs-meaning" class="meaning"></p>
      <p id="srs-word-length" class="word-length"></p>
      <p id="srs-word-status" class="text-muted"></p>
    </div>
    
    <!-- ç­”æ¡ˆè¼¸å…¥å€ -->
    <div id="srs-answer-area" style="display:none;">
      <input type="text" id="srs-user-input" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
      <button id="srs-submit-answer">æäº¤ç­”æ¡ˆ</button>
    </div>
    
    <!-- çµæœé¡¯ç¤ºå€ -->
    <div id="srs-result-area" style="display: none;">
      <p id="srs-result-message"></p>
      <p id="srs-correct-answer"></p>
      <p id="srs-next-review" class="text-muted"></p>
      <button id="srs-next-question">ä¸‹ä¸€é¡Œ</button>
    </div>
    
    <!-- æ§åˆ¶æŒ‰éˆ• -->
    <div id="srs-controls">
      <button id="srs-start-learning">é–‹å§‹å­¸ç¿’</button>
      <button onclick="showMainMenu()">è¿”å›ä¸»é¸å–®</button>
    </div>
  </div>

  <!-- æ‰“å­—å¡«ç©ºç·´ç¿’å€å¡Š -->
  <div class="card" id="typing-practice" style="display:none;">
    <h2 id="practice-title">æ‰“å­—å¡«ç©ºç·´ç¿’</h2>
    
    <!-- é¡Œç›®é¡¯ç¤ºå€ -->
    <div id="question-area">
      <p id="sentence" class="sentence"></p>
      <p id="meaning" class="meaning"></p>
      <p id="word-length" class="word-length"></p>
    </div>
    
    <!-- ç­”æ¡ˆè¼¸å…¥å€ -->
    <div id="answer-area">
      <input type="text" id="user-input" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
      <button id="submit-answer">æäº¤ç­”æ¡ˆ</button>
    </div>
    
    <!-- çµæœé¡¯ç¤ºå€ -->
    <div id="result-area" style="display: none;">
      <p id="result-message"></p>
      <p id="correct-answer"></p>
      <button id="next-question">ä¸‹ä¸€é¡Œ</button>
    </div>
    
    <!-- è¿”å›æŒ‰éˆ• -->
    <button id="back-to-main">è¿”å›ä¸»é¸å–®</button>
    <div class="stats">
      <div class="stat">ç­”å° <span id="stat-correct">0</span></div>
      <div class="stat">ç­”éŒ¯ <span id="stat-wrong">0</span></div>
      <div class="stat">æ­£ç¢ºç‡ <span id="stat-rate">0%</span></div>
    </div>
  </div>

  <script>
    let token = '';

    function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      })
      .then(res => res.json())
      .then(data => {
        if (data.token) {
          token = data.token;
          document.getElementById('login-card').style.display = 'none';
          document.getElementById('main').style.display = '';
        } else {
          document.getElementById('loginMsg').innerText = data.message || 'ç™»å…¥å¤±æ•—';
        }
      });
    }

    function getWords() {
      fetch('/api/words', {
        headers: { 'Authorization': 'Bearer ' + token }
      })
      .then(res => res.json())
      .then(words => {
        const ul = document.getElementById('words');
        ul.innerHTML = '';
        words.forEach(w => {
          const li = document.createElement('li');
          li.innerText = `${w.word} - ${w.definition}`;
          ul.appendChild(li);
        });
      });
    }

    // === å­¸ç¿’é€²åº¦åŠŸèƒ½ ===
    let currentProgressPage = 1;
    let progressPerPage = 15;
    let allProgress = [];
    let filteredProgress = [];

    async function getProgress() {
      try {
        hideAllSections();
        document.getElementById('progress-display').style.display = 'block';
        
        const response = await fetch('/api/progress', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const progress = await response.json();
        
        allProgress = progress;
        filteredProgress = progress;
        currentProgressPage = 1;
        
        displayProgress();
        setupProgressPagination();
        setupProgressSearch();
        
        document.getElementById('progress-stats').textContent = `å…± ${progress.length} å€‹å­¸ç¿’ä¸­çš„å–®å­—`;
        
      } catch (error) {
        console.error('è¼‰å…¥é€²åº¦å¤±æ•—:', error);
        alert('è¼‰å…¥é€²åº¦å¤±æ•—ï¼Œè«‹é‡è©¦');
      }
    }

    // é¡¯ç¤ºé€²åº¦å¡ç‰‡
    function displayProgress() {
      const startIndex = (currentProgressPage - 1) * progressPerPage;
      const endIndex = startIndex + progressPerPage;
      const progressToShow = filteredProgress.slice(startIndex, endIndex);
      
      const container = document.getElementById('progress-container');
      container.innerHTML = '';
      
      progressToShow.forEach(progress => {
        const progressCard = document.createElement('div');
        progressCard.className = 'progress-card';
        
        // æ ¼å¼åŒ–ä¸‹æ¬¡è¤‡ç¿’æ™‚é–“
        const nextReviewDate = new Date(progress.next_review_at);
        const now = new Date();
        const isOverdue = nextReviewDate <= now;
        
        const timeDisplay = isOverdue ? 
          'éœ€è¦è¤‡ç¿’' : 
          `${nextReviewDate.getMonth() + 1}/${nextReviewDate.getDate()} ${nextReviewDate.getHours()}:${nextReviewDate.getMinutes().toString().padStart(2, '0')}`;
        
        progressCard.innerHTML = `
          <div class="next-review">${timeDisplay}</div>
          <div class="progress-word">${progress.word}</div>
          <div class="progress-definition">${progress.definition || 'ç„¡å®šç¾©'}</div>
          <div class="progress-status ${progress.status === 'learning' ? 'status-learning' : 'status-reviewing'}">
            ${progress.status === 'learning' ? 'å­¸ç¿’ä¸­' : 'è¤‡ç¿’ä¸­'}
          </div>
          <div class="progress-time">
            æœ€å¾Œç·´ç¿’: ${progress.last_practiced_at ? new Date(progress.last_practiced_at).toLocaleDateString() : 'å°šæœªç·´ç¿’'}
          </div>
        `;
        
        container.appendChild(progressCard);
      });
    }

    // è¨­å®šé€²åº¦åˆ†é 
    function setupProgressPagination() {
      const totalPages = Math.ceil(filteredProgress.length / progressPerPage);
      const paginationContainer = document.getElementById('progress-pagination');
      paginationContainer.innerHTML = '';
      
      if (totalPages <= 1) return;
      
      // ä¸Šä¸€é æŒ‰éˆ•
      if (currentProgressPage > 1) {
        const prevBtn = document.createElement('button');
        prevBtn.textContent = 'â€¹ ä¸Šä¸€é ';
        prevBtn.className = 'pagination-btn';
        prevBtn.onclick = () => {
          currentProgressPage--;
          displayProgress();
          setupProgressPagination();
        };
        paginationContainer.appendChild(prevBtn);
      }
      
      // é ç¢¼æŒ‰éˆ•
      const startPage = Math.max(1, currentProgressPage - 2);
      const endPage = Math.min(totalPages, currentProgressPage + 2);
      
      for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.textContent = i;
        pageBtn.className = 'pagination-btn' + (i === currentProgressPage ? ' active' : '');
        pageBtn.onclick = () => {
          currentProgressPage = i;
          displayProgress();
          setupProgressPagination();
        };
        paginationContainer.appendChild(pageBtn);
      }
      
      // ä¸‹ä¸€é æŒ‰éˆ•
      if (currentProgressPage < totalPages) {
        const nextBtn = document.createElement('button');
        nextBtn.textContent = 'ä¸‹ä¸€é  â€º';
        nextBtn.className = 'pagination-btn';
        nextBtn.onclick = () => {
          currentProgressPage++;
          displayProgress();
          setupProgressPagination();
        };
        paginationContainer.appendChild(nextBtn);
      }
    }

    // è¨­å®šé€²åº¦æœå°‹åŠŸèƒ½
    function setupProgressSearch() {
      const searchInput = document.getElementById('progress-search');
      searchInput.value = '';
      
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        
        if (searchTerm === '') {
          filteredProgress = allProgress;
        } else {
          filteredProgress = allProgress.filter(progress => 
            progress.word.toLowerCase().includes(searchTerm) ||
            (progress.definition && progress.definition.toLowerCase().includes(searchTerm))
          );
        }
        
        currentProgressPage = 1;
        displayProgress();
        setupProgressPagination();
        
        document.getElementById('progress-stats').textContent = 
          `å…± ${filteredProgress.length} å€‹å­¸ç¿’ä¸­çš„å–®å­— ${searchTerm ? `(æœå°‹: "${searchTerm}")` : ''}`;
      });
    }

    // === è¤‡ç¿’æ¨¡å¼åŠŸèƒ½ ===
    let reviewList = [];
    let reviewCurrent = 0;
    let reviewCompleted = 0;

    async function getReview() {
      try {
        hideAllSections();
        document.getElementById('review-mode').style.display = 'block';
        
        const response = await fetch('/api/review', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const words = await response.json();
        
        if (words.length === 0) {
          // é¡¯ç¤ºæ²’æœ‰è¤‡ç¿’å–®å­—çš„ç‹€æ…‹
          document.getElementById('review-controls').style.display = 'none';
          document.getElementById('review-complete-area').style.display = 'block';
          document.getElementById('review-complete-area').innerHTML = `
            <p style="font-size: 1.2em; color: #43e97b; font-weight: bold;">ğŸ¯ å¤ªæ£’äº†ï¼</p>
            <p style="color: #666;">ç›®å‰æ²’æœ‰éœ€è¦è¤‡ç¿’çš„å–®å­—ï¼Œç¹¼çºŒä¿æŒå­¸ç¿’é€²åº¦ï¼</p>
            <button onclick="showMainMenu()" style="margin-top: 1em;">è¿”å›ä¸»é¸å–®</button>
          `;
          return;
        }
        
        reviewList = words;
        reviewCurrent = 0;
        reviewCompleted = 0;
        
        // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
        document.getElementById('review-count-display').textContent = words.length;
        document.getElementById('review-completed').textContent = reviewCompleted;
        
        // é¡¯ç¤ºé–‹å§‹æŒ‰éˆ•
        document.getElementById('review-controls').style.display = 'block';
        document.getElementById('review-question-area').style.display = 'none';
        document.getElementById('review-answer-area').style.display = 'none';
        document.getElementById('review-result-area').style.display = 'none';
        document.getElementById('review-complete-area').style.display = 'none';
        
      } catch (error) {
        console.error('è¼‰å…¥è¤‡ç¿’å–®å­—å¤±æ•—:', error);
        alert('è¼‰å…¥è¤‡ç¿’å–®å­—å¤±æ•—ï¼Œè«‹é‡è©¦');
      }
    }

    function startReviewMode() {
      if (reviewList.length === 0) return;
      
      // éš±è—æ§åˆ¶æŒ‰éˆ•ï¼Œé¡¯ç¤ºé¡Œç›®
      document.getElementById('review-controls').style.display = 'none';
      showReviewQuestion();
    }

    function showReviewQuestion() {
      if (reviewCurrent >= reviewList.length) {
        // è¤‡ç¿’å®Œæˆ
        document.getElementById('review-question-area').style.display = 'none';
        document.getElementById('review-answer-area').style.display = 'none';
        document.getElementById('review-result-area').style.display = 'none';
        document.getElementById('review-complete-area').style.display = 'block';
        return;
      }
      
      const word = reviewList[reviewCurrent];
      document.getElementById('review-word').textContent = word.word;
      document.getElementById('review-definition').textContent = word.definition;
      
      // é¡¯ç¤ºé¡Œç›®å’Œç­”æ¡ˆé¸æ“‡
      document.getElementById('review-question-area').style.display = 'block';
      document.getElementById('review-answer-area').style.display = 'block';
      document.getElementById('review-result-area').style.display = 'none';
    }

    async function answerReview(correct) {
      const word = reviewList[reviewCurrent];
      
      try {
        const response = await fetch('/api/review/answer', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ word_id: word.id, correct })
        });
        
        const result = await response.json();
        
        // éš±è—ç­”æ¡ˆé¸æ“‡ï¼Œé¡¯ç¤ºçµæœ
        document.getElementById('review-answer-area').style.display = 'none';
        document.getElementById('review-result-area').style.display = 'block';
        
        // é¡¯ç¤ºçµæœè¨Šæ¯
        if (correct) {
          document.getElementById('review-result-message').innerHTML = 'ğŸ‰ å¾ˆå¥½ï¼ä½ è¨˜å¾—é€™å€‹å–®å­—ï¼';
          document.getElementById('review-result-message').className = 'result-success';
          if (result.next_review) {
            const nextDate = new Date(result.next_review).toLocaleDateString('zh-TW');
            document.getElementById('review-next-time').textContent = `ä¸‹æ¬¡è¤‡ç¿’æ™‚é–“ï¼š${nextDate}`;
          }
        } else {
          document.getElementById('review-result-message').innerHTML = 'ğŸ’ª æ²’é—œä¿‚ï¼Œå¤šè¤‡ç¿’å¹¾æ¬¡å°±æœƒè¨˜ä½çš„ï¼';
          document.getElementById('review-result-message').className = 'result-error';
          document.getElementById('review-next-time').textContent = 'ç¨å¾Œæœƒå†æ¬¡å‡ºç¾è¤‡ç¿’';
        }
        
        reviewCompleted++;
        document.getElementById('review-completed').textContent = reviewCompleted;
        
      } catch (error) {
        console.error('æäº¤è¤‡ç¿’ç­”æ¡ˆå¤±æ•—:', error);
        alert('æäº¤ç­”æ¡ˆå¤±æ•—ï¼Œè«‹é‡è©¦');
      }
    }

    function nextReviewQuestion() {
      reviewCurrent++;
      showReviewQuestion();
    }

    // function register() {
    //   const username = document.getElementById('reg_username').value;
    //   const password = document.getElementById('reg_password').value;
    //   fetch('/api/auth/register', {
    //     method: 'POST',
    //     headers: { 'Content-Type': 'application/json' },
    //     body: JSON.stringify({ username, password })
    //   })
    //   .then(res => res.json())
    //   .then(data => {
    //     document.getElementById('regMsg').innerText = data.message || 'è¨»å†ŠæˆåŠŸï¼Œè«‹ç™»å…¥';
    //   });
    // }

    function logout() {
      token = '';
      document.getElementById('main').style.display = 'none';
      document.getElementById('login-card').style.display = '';
    }

    // æ‰“å­—å¡«ç©ºç·´ç¿’åŠŸèƒ½
    let currentQuestion = null;
    let wrongList = [];
    let questionCount = 0;
    let currentLevel = 'mixed';
    let BATCH_SIZE = 10;

    // çµ±è¨ˆè®Šæ•¸
    let correctCount = 0;
    let wrongCount = 0;

    function updateStats() {
      const total = correctCount + wrongCount;
      document.getElementById('stat-correct').textContent = correctCount;
      document.getElementById('stat-wrong').textContent = wrongCount;
      document.getElementById('stat-rate').textContent = total > 0 ? Math.round(correctCount / total * 100) + '%' : '0%';
    }

    // é¡¯ç¤ºé›£åº¦é¸æ“‡
    function showDifficultySelection() {
      hideAllSections();
      document.getElementById('difficulty-selection').style.display = 'block';
    }

    // é–‹å§‹æŒ‡å®šé›£åº¦çš„ç·´ç¿’
    function startPractice(level) {
      currentLevel = level;
      BATCH_SIZE = (level === '400') ? 10 : 20;
      
      hideAllSections();
      document.getElementById('typing-practice').style.display = 'block';
      
      // è¨­å®šæ¨™é¡Œ
      const title = level === '400' ? '400 å–®å­—ç·´ç¿’' : 
                   level === '1200' ? '1200 å–®å­—ç·´ç¿’' :
                   level === '2000' ? '2000 å–®å­—ç·´ç¿’' : 'æ··åˆæ¨¡å¼ç·´ç¿’';
      document.getElementById('practice-title').textContent = title;
      
      // é‡ç½®çµ±è¨ˆ
      correctCount = 0;
      wrongCount = 0;
      questionCount = 0;
      wrongList = [];
      updateStats();
      
      loadNewQuestion();
    }

    // è¼‰å…¥æ–°é¡Œç›®
    async function loadNewQuestion() {
      try {
        const url = currentLevel === 'mixed' ? '/api/practice/typing' : `/api/practice/typing?level=${currentLevel}`;
        const response = await fetch(url, {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await response.json();
        
        currentQuestion = data;
        document.getElementById('sentence').textContent = data.sentence;
        document.getElementById('meaning').textContent = data.meaning;
        document.getElementById('word-length').textContent = `å–®å­—é•·åº¦ï¼š${data.wordLength} å€‹å­—æ¯`;
        
        // æ¸…ç©ºè¼¸å…¥æ¡†å’Œçµæœ
        document.getElementById('user-input').value = '';
        document.getElementById('result-area').style.display = 'none';
        document.getElementById('answer-area').style.display = 'block';
        document.getElementById('user-input').focus();
        
      } catch (error) {
        console.error('è¼‰å…¥é¡Œç›®å¤±æ•—:', error);
        alert('è¼‰å…¥é¡Œç›®å¤±æ•—ï¼Œè«‹é‡è©¦');
      }
    }

    // æäº¤ç­”æ¡ˆ
    async function submitAnswer() {
      const userInput = document.getElementById('user-input').value.trim();
      if (!userInput) {
        alert('è«‹è¼¸å…¥ç­”æ¡ˆ');
        return;
      }
      
      try {
        const response = await fetch('/api/practice/typing/answer', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({
            id: currentQuestion.id,
            userInput: userInput
          })
        });
        
        const result = await response.json();
        
        // é¡¯ç¤ºçµæœ
        const resultMessage = document.getElementById('result-message');
        const correctAnswer = document.getElementById('correct-answer');
        
        questionCount++;
        
        if (result.correct) {
          resultMessage.textContent = 'ğŸ‰ å¤ªæ£’äº†ï¼ç­”å°äº†ï¼';
          resultMessage.className = 'result-success';
          correctCount++;
        } else {
          resultMessage.textContent = `ğŸ˜… ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ã€Œ${result.correctAnswer}ã€`;
          resultMessage.className = 'result-error';
          wrongCount++;
          // æ”¶é›†éŒ¯é¡Œ
          wrongList.push({
            id: currentQuestion.id,
            sentence: currentQuestion.sentence,
            meaning: currentQuestion.meaning,
            wordLength: currentQuestion.wordLength,
            correctAnswer: result.correctAnswer
          });
        }
        
        correctAnswer.textContent = `æ­£ç¢ºç­”æ¡ˆï¼š${result.correctAnswer}`;
        
        // éš±è—è¼¸å…¥å€ï¼Œé¡¯ç¤ºçµæœå€
        document.getElementById('answer-area').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        
        updateStats(); // æ›´æ–°çµ±è¨ˆ
        
        // æª¢æŸ¥æ˜¯å¦è©²é€²å…¥éŒ¯é¡Œè¤‡ç¿’
        if (questionCount % BATCH_SIZE === 0 && wrongList.length > 0) {
          document.getElementById('next-question').textContent = 'é–‹å§‹éŒ¯é¡Œè¤‡ç¿’';
        }
        
      } catch (error) {
        console.error('æäº¤ç­”æ¡ˆå¤±æ•—:', error);
        alert('æäº¤ç­”æ¡ˆå¤±æ•—ï¼Œè«‹é‡è©¦');
      }
    }

    // ä¸‹ä¸€é¡Œ
    function nextQuestion() {
      // æª¢æŸ¥æ˜¯å¦è©²é€²å…¥éŒ¯é¡Œè¤‡ç¿’
      if (questionCount % BATCH_SIZE === 0 && wrongList.length > 0) {
        startWrongPractice();
      } else {
        loadNewQuestion();
      }
    }

    // éš±è—æ‰€æœ‰å€å¡Š
    function hideAllSections() {
      document.getElementById('main').style.display = 'none';
      document.getElementById('typing-practice').style.display = 'none';
      document.getElementById('difficulty-selection').style.display = 'none';
      document.getElementById('srs-settings').style.display = 'none';
      document.getElementById('srs-learning').style.display = 'none';
      document.getElementById('word-lists').style.display = 'none';
      document.getElementById('word-display').style.display = 'none';
      document.getElementById('progress-display').style.display = 'none';
      document.getElementById('review-mode').style.display = 'none';
    }

    // é¡¯ç¤ºä¸»é¸å–®
    function showMainMenu() {
      hideAllSections();
      document.getElementById('main').style.display = 'block';
    }

    // === SRS å­¸ç¿’åŠŸèƒ½ ===
    let srsCurrentQuestion = null;
    let srsTodayCount = 0;
    let srsCurrentLevel = 'mixed';
    let srsDailyLimit = 10;
    let srsNewWordsToday = 0;

    // é¡¯ç¤º SRS è¨­å®šä»‹é¢
    function showSrsLearning() {
      hideAllSections();
      document.getElementById('srs-settings').style.display = 'block';
    }

    // é¸æ“‡ SRS é›£åº¦ç­‰ç´š
    function selectSrsLevel(level) {
      srsCurrentLevel = level;
      
      // æ›´æ–°æŒ‰éˆ•è¦–è¦ºç‹€æ…‹
      document.querySelectorAll('#srs-settings button[id^="srs-"]').forEach(btn => {
        btn.classList.remove('btn-success');
        btn.classList.add('btn-primary');
      });
      const selectedBtn = document.getElementById(`srs-${level}`);
      selectedBtn.classList.remove('btn-primary');
      selectedBtn.classList.add('btn-success');
      
      const title = level === '400' ? '400 å–®å­— SRS å­¸ç¿’' : 
                   level === '1200' ? '1200 å–®å­— SRS å­¸ç¿’' :
                   level === '2000' ? '2000 å–®å­— SRS å­¸ç¿’' : 'æ··åˆæ¨¡å¼ SRS å­¸ç¿’';
      document.getElementById('srs-title').textContent = title;
    }

    // é–‹å§‹ SRS å­¸ç¿’æœƒè©±
    async function startSrsSession() {
      const dailyLimit = parseInt(document.getElementById('srs-daily-limit').value);
      if (dailyLimit < 5) {
        alert('æ¯æ—¥æ–°å–®å­—æ•¸é‡ä¸èƒ½å°‘æ–¼ 5 å€‹');
        return;
      }
      
      srsDailyLimit = dailyLimit;
      srsNewWordsToday = 0;
      
      document.getElementById('srs-daily-goal').textContent = dailyLimit;
      
      hideAllSections();
      document.getElementById('srs-learning').style.display = 'block';
      await updateSrsStatus();
      await startSrsLearning();
    }

    // æ›´æ–° SRS ç‹€æ…‹çµ±è¨ˆ
    async function updateSrsStatus() {
      try {
        // å–å¾—å¾…è¤‡ç¿’å–®å­—æ•¸é‡
        const reviewResponse = await fetch('/api/review', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const reviewWords = await reviewResponse.json();
        
        // å–å¾—æ–°å–®å­—æ•¸é‡ï¼ˆæ ¹æ“šé¸æ“‡çš„é›£åº¦ï¼‰
        const levelParam = srsCurrentLevel === 'mixed' ? '' : `?level=${srsCurrentLevel}`;
        const newWordsResponse = await fetch(`/api/review/new-words-count${levelParam}`, {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const newWordsData = await newWordsResponse.json();
        
        document.getElementById('srs-review-count').textContent = reviewWords.length || 0;
        document.getElementById('srs-new-count').textContent = newWordsData.count || 0;
        document.getElementById('srs-today-count').textContent = srsTodayCount;
        
      } catch (error) {
        console.error('æ›´æ–° SRS ç‹€æ…‹å¤±æ•—:', error);
      }
    }

    // é–‹å§‹ SRS å­¸ç¿’
    async function startSrsLearning() {
      try {
        // éš±è—æ§åˆ¶æŒ‰éˆ•ï¼Œé¡¯ç¤ºé¡Œç›®å€åŸŸ
        document.getElementById('srs-controls').style.display = 'none';
        document.getElementById('srs-question-area').style.display = 'block';
        document.getElementById('srs-answer-area').style.display = 'block';
        
        await loadSrsQuestion();
      } catch (error) {
        console.error('é–‹å§‹ SRS å­¸ç¿’å¤±æ•—:', error);
        alert('é–‹å§‹å­¸ç¿’å¤±æ•—ï¼Œè«‹é‡è©¦');
      }
    }

    // è¼‰å…¥ SRS é¡Œç›®
    async function loadSrsQuestion() {
      try {
        // æª¢æŸ¥æ˜¯å¦é”åˆ°æ¯æ—¥æ–°å–®å­—é™åˆ¶
        if (srsNewWordsToday >= srsDailyLimit) {
          // åªè™•ç†è¤‡ç¿’å–®å­—
          const reviewResponse = await fetch('/api/review/typing?reviewOnly=true', {
            headers: { 'Authorization': 'Bearer ' + token }
          });
          
          if (reviewResponse.ok) {
            const data = await reviewResponse.json();
            displaySrsQuestion(data, false);
          } else {
            showDailyCompleted();
          }
          return;
        }
        
        // æ­£å¸¸ç²å–å–®å­—ï¼ˆå¾©ç¿’å„ªå…ˆï¼Œç„¶å¾Œæ–°å–®å­—ï¼‰
        const levelParam = srsCurrentLevel === 'mixed' ? '' : `?level=${srsCurrentLevel}`;
        const reviewResponse = await fetch(`/api/review/typing${levelParam}`, {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        
        if (reviewResponse.ok) {
          const data = await reviewResponse.json();
          displaySrsQuestion(data, data.isNew);
        } else {
          showDailyCompleted();
        }
        
      } catch (error) {
        console.error('è¼‰å…¥ SRS é¡Œç›®å¤±æ•—:', error);
        alert('è¼‰å…¥é¡Œç›®å¤±æ•—ï¼Œè«‹é‡è©¦');
      }
    }

    // é¡¯ç¤º SRS é¡Œç›®
    function displaySrsQuestion(data, isNew) {
      srsCurrentQuestion = data;
      
      document.getElementById('srs-sentence').textContent = data.sentence;
      document.getElementById('srs-meaning').textContent = data.meaning;
      document.getElementById('srs-word-length').textContent = `å–®å­—é•·åº¦ï¼š${data.wordLength} å€‹å­—æ¯`;
      
      // æ ¹æ“šæ˜¯å¦ç‚ºæ–°å–®å­—é¡¯ç¤ºä¸åŒç‹€æ…‹
      if (isNew) {
        document.getElementById('srs-word-status').textContent = 'ğŸ†• æ–°å–®å­—';
        document.getElementById('srs-word-status').style.color = '#43e97b';
      } else {
        document.getElementById('srs-word-status').textContent = 'ğŸ”„ è¤‡ç¿’å–®å­—';
        document.getElementById('srs-word-status').style.color = '#7C4DFF';
      }
      
      // æ¸…ç©ºè¼¸å…¥æ¡†å’Œçµæœ
      document.getElementById('srs-user-input').value = '';
      document.getElementById('srs-result-area').style.display = 'none';
      document.getElementById('srs-answer-area').style.display = 'block';
      document.getElementById('srs-user-input').focus();
    }

    // é¡¯ç¤ºæ¯æ—¥å®Œæˆç‹€æ…‹
    function showDailyCompleted() {
      document.getElementById('srs-question-area').innerHTML = `
        <h3>ğŸ‰ ä»Šæ—¥å­¸ç¿’å®Œæˆï¼</h3>
        <p>å·²å®Œæˆ ${srsNewWordsToday} å€‹æ–°å–®å­—çš„å­¸ç¿’</p>
        <p>ç¸½å…±ç­”é¡Œ ${srsTodayCount} æ¬¡</p>
        <div style="margin-top: 1.5em;">
          <button onclick="continueExtraLearning()">ç¹¼çºŒå­¸ç¿’</button>
          <button onclick="finishSrsSession()">çµæŸå­¸ç¿’</button>
        </div>
      `;
      document.getElementById('srs-answer-area').style.display = 'none';
      document.getElementById('srs-result-area').style.display = 'none';
      document.getElementById('srs-controls').style.display = 'none';
      document.getElementById('srs-question-area').style.display = 'block';
    }

    // ç¹¼çºŒé¡å¤–å­¸ç¿’
    function continueExtraLearning() {
      srsNewWordsToday = 0; // é‡ç½®è¨ˆæ•¸ï¼Œå…è¨±å­¸ç¿’æ›´å¤šæ–°å–®å­—
      document.getElementById('srs-question-area').style.display = 'block';
      document.getElementById('srs-answer-area').style.display = 'block';
      loadSrsQuestion();
    }

    // çµæŸ SRS å­¸ç¿’æœƒè©±
    function finishSrsSession() {
      showMainMenu();
    }

    // æäº¤ SRS ç­”æ¡ˆ
    async function submitSrsAnswer() {
      const userInput = document.getElementById('srs-user-input').value.trim();
      if (!userInput) {
        alert('è«‹è¼¸å…¥ç­”æ¡ˆ');
        return;
      }
      
      try {
        const response = await fetch('/api/review/typing/answer', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({
            word_id: srsCurrentQuestion.id,
            userInput: userInput
          })
        });
        
        const result = await response.json();
        
        // é¡¯ç¤ºçµæœ
        const resultMessage = document.getElementById('srs-result-message');
        const correctAnswer = document.getElementById('srs-correct-answer');
        const nextReview = document.getElementById('srs-next-review');
        
        if (result.correct) {
          resultMessage.textContent = 'ğŸ‰ å¤ªæ£’äº†ï¼ç­”å°äº†ï¼';
          resultMessage.className = 'result-success';
        } else {
          resultMessage.textContent = `ğŸ˜… ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ã€Œ${result.correctAnswer}ã€`;
          resultMessage.className = 'result-error';
        }
        
        correctAnswer.textContent = `æ­£ç¢ºç­”æ¡ˆï¼š${result.correctAnswer}`;
        
        // é¡¯ç¤ºä¸‹æ¬¡è¤‡ç¿’æ™‚é–“ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
        if (result.nextReviewTime) {
          const nextDate = new Date(result.nextReviewTime);
          nextReview.textContent = `ä¸‹æ¬¡è¤‡ç¿’ï¼š${nextDate.toLocaleDateString()} ${nextDate.toLocaleTimeString()}`;
        }
        
        // éš±è—è¼¸å…¥å€ï¼Œé¡¯ç¤ºçµæœå€
        document.getElementById('srs-answer-area').style.display = 'none';
        document.getElementById('srs-result-area').style.display = 'block';
        
        // æ›´æ–°çµ±è¨ˆ
        srsTodayCount++;
        if (srsCurrentQuestion.isNew) {
          srsNewWordsToday++; // æ–°å–®å­—è¨ˆå…¥æ¯æ—¥æ•¸é‡ï¼ˆä¸è«–å°éŒ¯ï¼‰
        }
        await updateSrsStatus();
        
        // æª¢æŸ¥æ˜¯å¦é”åˆ°æ¯æ—¥ç›®æ¨™
        if (srsNewWordsToday >= srsDailyLimit) {
          // å»¶é²ä¸€é»æ™‚é–“è®“ç”¨æˆ¶çœ‹åˆ°çµæœï¼Œç„¶å¾Œé¡¯ç¤ºå®Œæˆç•«é¢
          setTimeout(() => {
            showDailyCompleted();
          }, 2000);
        }
        
      } catch (error) {
        console.error('æäº¤ SRS ç­”æ¡ˆå¤±æ•—:', error);
        alert('æäº¤ç­”æ¡ˆå¤±æ•—ï¼Œè«‹é‡è©¦');
      }
    }

    // SRS ä¸‹ä¸€é¡Œ
    function nextSrsQuestion() {
      loadSrsQuestion();
    }

    // === å–®å­—åˆ—è¡¨åŠŸèƒ½ ===
    let currentWordLevel = null;
    let currentWordPage = 1;
    let wordsPerPage = 20;
    let allWords = [];
    let filteredWords = [];

    // é¡¯ç¤ºå–®å­—åˆ—è¡¨é¸æ“‡é é¢
    function showWordLists() {
      hideAllSections();
      document.getElementById('word-lists').style.display = 'block';
    }

    // æ ¹æ“šç­‰ç´šé¡¯ç¤ºå–®å­—
    async function showWordsByLevel(level) {
      currentWordLevel = level;
      currentWordPage = 1;
      
      hideAllSections();
      document.getElementById('word-display').style.display = 'block';
      document.getElementById('word-display-title').textContent = `${level} å–®å­—åˆ—è¡¨`;
      
      try {
        const response = await fetch(`/api/words?level=${level}`, {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const words = await response.json();
        
        allWords = words;
        filteredWords = words;
        displayWords();
        setupPagination();
        setupSearch();
        
        document.getElementById('word-stats').textContent = `å…± ${words.length} å€‹å–®å­—`;
        
      } catch (error) {
        console.error('è¼‰å…¥å–®å­—å¤±æ•—:', error);
        alert('è¼‰å…¥å–®å­—å¤±æ•—ï¼Œè«‹é‡è©¦');
      }
    }

    // é¡¯ç¤ºå–®å­—å¡ç‰‡
    function displayWords() {
      const startIndex = (currentWordPage - 1) * wordsPerPage;
      const endIndex = startIndex + wordsPerPage;
      const wordsToShow = filteredWords.slice(startIndex, endIndex);
      
      const container = document.getElementById('word-container');
      container.innerHTML = '';
      
      wordsToShow.forEach(word => {
        const wordCard = document.createElement('div');
        wordCard.className = 'word-card';
        wordCard.innerHTML = `
          <div class="word-title">${word.word}</div>
          <div class="word-definition">${word.definition || 'ç„¡å®šç¾©'}</div>
          ${word.sentence ? `<div class="word-sentence">${word.sentence}</div>` : ''}
        `;
        container.appendChild(wordCard);
      });
    }

    // è¨­å®šåˆ†é 
    function setupPagination() {
      const totalPages = Math.ceil(filteredWords.length / wordsPerPage);
      const paginationContainer = document.getElementById('pagination');
      paginationContainer.innerHTML = '';
      
      if (totalPages <= 1) return;
      
      // ä¸Šä¸€é æŒ‰éˆ•
      if (currentWordPage > 1) {
        const prevBtn = document.createElement('button');
        prevBtn.textContent = 'â€¹ ä¸Šä¸€é ';
        prevBtn.className = 'pagination-btn';
        prevBtn.onclick = () => {
          currentWordPage--;
          displayWords();
          setupPagination();
        };
        paginationContainer.appendChild(prevBtn);
      }
      
      // é ç¢¼æŒ‰éˆ•
      const startPage = Math.max(1, currentWordPage - 2);
      const endPage = Math.min(totalPages, currentWordPage + 2);
      
      for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.textContent = i;
        pageBtn.className = 'pagination-btn' + (i === currentWordPage ? ' active' : '');
        pageBtn.onclick = () => {
          currentWordPage = i;
          displayWords();
          setupPagination();
        };
        paginationContainer.appendChild(pageBtn);
      }
      
      // ä¸‹ä¸€é æŒ‰éˆ•
      if (currentWordPage < totalPages) {
        const nextBtn = document.createElement('button');
        nextBtn.textContent = 'ä¸‹ä¸€é  â€º';
        nextBtn.className = 'pagination-btn';
        nextBtn.onclick = () => {
          currentWordPage++;
          displayWords();
          setupPagination();
        };
        paginationContainer.appendChild(nextBtn);
      }
    }

    // è¨­å®šæœå°‹åŠŸèƒ½
    function setupSearch() {
      const searchInput = document.getElementById('word-search');
      searchInput.value = '';
      
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        
        if (searchTerm === '') {
          filteredWords = allWords;
        } else {
          filteredWords = allWords.filter(word => 
            word.word.toLowerCase().includes(searchTerm) ||
            (word.definition && word.definition.toLowerCase().includes(searchTerm))
          );
        }
        
        currentWordPage = 1;
        displayWords();
        setupPagination();
        
        document.getElementById('word-stats').textContent = 
          `å…± ${filteredWords.length} å€‹å–®å­— ${searchTerm ? `(æœå°‹: "${searchTerm}")` : ''}`;
      });
    }

    let reviewingWrong = false;

    // éŒ¯é¡Œè¤‡ç¿’åŠŸèƒ½
    function startWrongPractice() {
      if (wrongList.length === 0) {
        alert('æ²’æœ‰éŒ¯é¡Œéœ€è¦è¤‡ç¿’ï¼Œç¹¼çºŒç·´ç¿’æ–°é¡Œç›®');
        loadNewQuestion();
        return;
      }
      reviewingWrong = true;
      const practiceDiv = document.getElementById('typing-practice');
      practiceDiv.innerHTML = `
        <h2>éŒ¯é¡Œè¤‡ç¿’</h2>
        <div id="wrong-question-area">
          <p id="wrong-sentence" class="sentence"></p>
          <p id="wrong-meaning" class="meaning"></p>
          <p id="wrong-word-length" class="word-length"></p>
        </div>
        <div id="wrong-answer-area">
          <input type="text" id="wrong-user-input" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          <button id="wrong-submit-answer">æäº¤ç­”æ¡ˆ</button>
        </div>
        <div id="wrong-result-area" style="display: none;">
          <p id="wrong-result-message"></p>
          <p id="wrong-correct-answer"></p>
          <button id="wrong-next-question">ä¸‹ä¸€é¡Œ</button>
        </div>
        <button id="back-to-main">è¿”å›ä¸»é¸å–®</button>
        <div class="stats">
          <div class="stat">ç­”å° <span id="wrong-stat-correct">0</span></div>
          <div class="stat">ç­”éŒ¯ <span id="wrong-stat-wrong">0</span></div>
          <div class="stat">æ­£ç¢ºç‡ <span id="wrong-stat-rate">0%</span></div>
        </div>
      `;
      document.getElementById('wrong-user-input').focus();
      document.getElementById('wrong-submit-answer').addEventListener('click', submitWrongAnswer);
      document.getElementById('wrong-next-question').addEventListener('click', nextWrongQuestion);
      document.getElementById('back-to-main').addEventListener('click', showMainMenu);
      document.getElementById('wrong-user-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          submitWrongAnswer();
        }
      });
      loadNewWrongQuestion();
    }

    async function loadNewWrongQuestion() {
      if (wrongList.length === 0) {
        document.getElementById('wrong-result-area').innerHTML = 'éŒ¯é¡Œè¤‡ç¿’å®Œæˆï¼';
        return;
      }
      const w = wrongList[0];
      document.getElementById('wrong-sentence').textContent = w.sentence;
      document.getElementById('wrong-meaning').textContent = w.meaning;
      document.getElementById('wrong-word-length').textContent = `å–®å­—é•·åº¦ï¼š${w.wordLength} å€‹å­—æ¯`;
      document.getElementById('wrong-result-area').style.display = 'none';
      document.getElementById('wrong-answer-area').style.display = 'block';
      document.getElementById('wrong-user-input').value = '';
    }

    async function submitWrongAnswer() {
      const userInput = document.getElementById('wrong-user-input').value.trim();
      if (!userInput) {
        alert('è«‹è¼¸å…¥ç­”æ¡ˆ');
        return;
      }
      const w = wrongList[0];
      try {
        const response = await fetch('/api/practice/typing/answer', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({
            id: w.id,
            userInput: userInput
          })
        });
        const result = await response.json();
        document.getElementById('wrong-result-message').textContent = result.correct ? 'ğŸ‰ å¤ªæ£’äº†ï¼ç­”å°äº†ï¼' : `ğŸ˜… ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ã€Œ${result.correctAnswer}ã€`;
        document.getElementById('wrong-correct-answer').textContent = `æ­£ç¢ºç­”æ¡ˆï¼š${result.correctAnswer}`;
        document.getElementById('wrong-result-area').style.display = 'block';
        document.getElementById('wrong-answer-area').style.display = 'none';
        if (result.correct) {
          wrongList.shift(); // ç§»é™¤å·²ç¶“ç­”å°çš„é¡Œç›®
          document.getElementById('wrong-stat-correct').textContent = parseInt(document.getElementById('wrong-stat-correct').textContent) + 1;
        } else {
          document.getElementById('wrong-stat-wrong').textContent = parseInt(document.getElementById('wrong-stat-wrong').textContent) + 1;
        }
        document.getElementById('wrong-stat-rate').textContent = `${((parseInt(document.getElementById('wrong-stat-correct').textContent) / (parseInt(document.getElementById('wrong-stat-correct').textContent) + parseInt(document.getElementById('wrong-stat-wrong').textContent))) * 100).toFixed(0)}%`;
      } catch (error) {
        console.error('æäº¤éŒ¯é¡Œç­”æ¡ˆå¤±æ•—:', error);
        alert('æäº¤éŒ¯é¡Œç­”æ¡ˆå¤±æ•—ï¼Œè«‹é‡è©¦');
      }
    }

    function nextWrongQuestion() {
      if (wrongList.length === 0) {
        // éŒ¯é¡Œè¤‡ç¿’å®Œæˆï¼Œé¡¯ç¤ºé¸é …
        hideAllSections();
        document.getElementById('typing-practice').style.display = 'block';
        document.getElementById('typing-practice').innerHTML = `
          <h2>éŒ¯é¡Œè¤‡ç¿’å®Œæˆï¼</h2>
          <div class="stats">
            <div class="stat">ç­”å° <span>${correctCount}</span></div>
            <div class="stat">ç­”éŒ¯ <span>${wrongCount}</span></div>
            <div class="stat">æ­£ç¢ºç‡ <span>${correctCount + wrongCount > 0 ? Math.round(correctCount / (correctCount + wrongCount) * 100) : 0}%</span></div>
          </div>
          <p>ä½ æƒ³è¦ç¹¼çºŒç·´ç¿’å—ï¼Ÿ</p>
          <button id="continue-practice">ç¹¼çºŒç·´ç¿’ ${BATCH_SIZE} é¡Œ</button>
          <button id="back-to-main">è¿”å›ä¸»é¸å–®</button>
          <button id="back-to-difficulty">é¸æ“‡å…¶ä»–é›£åº¦</button>
        `;
        
        // ç¶å®šäº‹ä»¶
        document.getElementById('continue-practice').addEventListener('click', function() {
          // ç¹¼çºŒç·´ç¿’ï¼Œé‡æ–°è¨­å®šç•Œé¢
          document.getElementById('typing-practice').innerHTML = `
            <h2 id="practice-title">${currentLevel === '400' ? '400 å–®å­—ç·´ç¿’' : currentLevel === '1200' ? '1200 å–®å­—ç·´ç¿’' : 'æ··åˆæ¨¡å¼ç·´ç¿’'}</h2>
            <div id="question-area">
              <p id="sentence" class="sentence"></p>
              <p id="meaning" class="meaning"></p>
              <p id="word-length" class="word-length"></p>
            </div>
            <div id="answer-area">
              <input type="text" id="user-input" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
              <button id="submit-answer">æäº¤ç­”æ¡ˆ</button>
            </div>
            <div id="result-area" style="display: none;">
              <p id="result-message"></p>
              <p id="correct-answer"></p>
              <button id="next-question">ä¸‹ä¸€é¡Œ</button>
            </div>
            <button id="back-to-main">è¿”å›ä¸»é¸å–®</button>
            <div class="stats">
              <div class="stat">ç­”å° <span id="stat-correct">${correctCount}</span></div>
              <div class="stat">ç­”éŒ¯ <span id="stat-wrong">${wrongCount}</span></div>
              <div class="stat">æ­£ç¢ºç‡ <span id="stat-rate">${correctCount + wrongCount > 0 ? Math.round(correctCount / (correctCount + wrongCount) * 100) : 0}%</span></div>
            </div>
          `;
          // é‡æ–°ç¶å®šäº‹ä»¶
          document.getElementById('submit-answer').addEventListener('click', submitAnswer);
          document.getElementById('next-question').addEventListener('click', nextQuestion);
          document.getElementById('back-to-main').addEventListener('click', showMainMenu);
          // Enter éµäº‹ä»¶å·²ç”± document çµ±ä¸€è™•ç†ï¼Œä¸éœ€è¦é‡è¤‡ç¶å®š
          loadNewQuestion();
        });
        
        document.getElementById('back-to-main').addEventListener('click', showMainMenu);
        document.getElementById('back-to-difficulty').addEventListener('click', showDifficultySelection);
        
      } else {
        loadNewWrongQuestion();
      }
    }

    // äº‹ä»¶ç›£è½å™¨
    document.addEventListener('DOMContentLoaded', function() {
      // æ‰“å­—å¡«ç©ºç·´ç¿’æŒ‰éˆ•
      const typingPracticeBtn = document.getElementById('typing-practice-btn');
      if (typingPracticeBtn) {
        typingPracticeBtn.addEventListener('click', showDifficultySelection);
      }
      
      // SRS å­¸ç¿’æŒ‰éˆ•
      const srsLearningBtn = document.getElementById('srs-learning-btn');
      if (srsLearningBtn) {
        srsLearningBtn.addEventListener('click', showSrsLearning);
      }
      
      // SRS é–‹å§‹å­¸ç¿’æŒ‰éˆ•
      const srsStartBtn = document.getElementById('srs-start-learning');
      if (srsStartBtn) {
        srsStartBtn.addEventListener('click', startSrsLearning);
      }
      
      // SRS æäº¤ç­”æ¡ˆæŒ‰éˆ•
      const srsSubmitBtn = document.getElementById('srs-submit-answer');
      if (srsSubmitBtn) {
        srsSubmitBtn.addEventListener('click', submitSrsAnswer);
      }
      
      // SRS ä¸‹ä¸€é¡ŒæŒ‰éˆ•
      const srsNextBtn = document.getElementById('srs-next-question');
      if (srsNextBtn) {
        srsNextBtn.addEventListener('click', nextSrsQuestion);
      }
      
      // æäº¤ç­”æ¡ˆæŒ‰éˆ•
      const submitAnswerBtn = document.getElementById('submit-answer');
      if (submitAnswerBtn) {
        submitAnswerBtn.addEventListener('click', submitAnswer);
      }
      
      // ä¸‹ä¸€é¡ŒæŒ‰éˆ•
      const nextQuestionBtn = document.getElementById('next-question');
      if (nextQuestionBtn) {
        nextQuestionBtn.addEventListener('click', nextQuestion);
      }
      
      // è¿”å›ä¸»é¸å–®æŒ‰éˆ•
      const backToMainBtn = document.getElementById('back-to-main');
      if (backToMainBtn) {
        backToMainBtn.addEventListener('click', showMainMenu);
      }
      
      // éŒ¯é¡Œè¤‡ç¿’æŒ‰éˆ•
      const wrongPracticeBtn = document.getElementById('wrong-next-question');
      if (wrongPracticeBtn) {
        wrongPracticeBtn.addEventListener('click', nextWrongQuestion);
      }

      // ç§»é™¤é‡è¤‡çš„ Enter äº‹ä»¶ç›£è½å™¨ï¼Œçµ±ä¸€ç”± document äº‹ä»¶è™•ç†


      // è®“å¸³è™Ÿæˆ–å¯†ç¢¼æ¬„ä½æŒ‰ä¸‹ Enter éƒ½èƒ½ç™»å…¥
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');

      function tryLoginOnEnter(e) {
        if (e.key === 'Enter') {
          login();
        }
      }

      usernameInput.addEventListener('keypress', tryLoginOnEnter);
      passwordInput.addEventListener('keypress', tryLoginOnEnter);

      // Enter éµè™•ç†ï¼šå…ˆæª¢æŸ¥ç­”æ¡ˆï¼Œå†é€²å…¥ä¸‹ä¸€é¡Œ
      document.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          // SRS å­¸ç¿’æ¨¡å¼
          if (document.getElementById('srs-learning').style.display !== 'none') {
            if (document.getElementById('srs-answer-area').style.display !== 'none') {
              submitSrsAnswer();
            } else if (document.getElementById('srs-result-area').style.display !== 'none') {
              nextSrsQuestion();
            }
          }
          // æ­£å¸¸ç·´ç¿’æ¨¡å¼
          else if (document.getElementById('typing-practice').style.display !== 'none') {
            if (document.getElementById('answer-area').style.display !== 'none') {
              submitAnswer();
            } else if (document.getElementById('result-area').style.display !== 'none') {
              nextQuestion();
            }
          }
          // éŒ¯é¡Œè¤‡ç¿’æ¨¡å¼
          else if (document.getElementById('wrong-answer-area') && document.getElementById('wrong-answer-area').style.display !== 'none') {
            submitWrongAnswer();
          } else if (document.getElementById('wrong-result-area') && document.getElementById('wrong-result-area').style.display !== 'none') {
            nextWrongQuestion();
          }
        }
      });
      
      // äº‹ä»¶ç›£è½å™¨å·²ç¶“çµ±ä¸€ç”± document è™•ç†ï¼Œé¿å…é‡è¤‡ç¶å®š
    });
  </script>
</body>
</html>
